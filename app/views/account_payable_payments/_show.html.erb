<td colspan="3">
    <button type="button" class="close cancel" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <div style="padding-top: 20px"></div>

    <dl class="dl-horizontal">
        <dt>Payment Date</dt>
        <dd><%= object.payment_date.strftime("%d/%m/%Y") %></dd>
    </dl>

    <dl class="dl-horizontal">
        <dt>Payment Method</dt>
        <dd id="show-app-payment-method-value-<%= object.id %>"></dd>
    </dl>

    <dl class="dl-horizontal">
        <dt>Total Paid</dt>
        <dd><%= number_to_currency(object.amount,
              :separator => ",",
              :delimiter => ".",
              :unit => "Rp",
              :precision => 2) %></dd>
    </dl>


    <table class="table table-striped table-condensed">
        <thead>
            <tr>
                <th rowspan="2" style="vertical-align: middle;text-align: center">No.</th>
                <th rowspan="2" style="vertical-align: middle;text-align: center">No. Inv</th>
                <th colspan="3" style="text-align: center">Vendor</th>
                <th colspan="2" style="text-align: center">Giro</th>
                <th rowspan="2" style="vertical-align: middle;text-align: center">Req. Pymnt Date</th>
                <th rowspan="2" style="vertical-align: middle;text-align: center">AMT Rec.</th>
                <th rowspan="2" style="vertical-align: middle;text-align: center">AMT Ret.</th>
                <th rowspan="2" style="vertical-align: middle;text-align: center">Paid</th>
                <th rowspan="2" style="vertical-align: middle;text-align: center">Debt</th>
            </tr>
            <tr>
                <th style="text-align: center">Name</th>
                <th style="text-align: center">Inv. Number</th>
                <th style="text-align: center">Inv. Date</th>
                <th style="text-align: center">Number</th>
                <th style="text-align: center">Date</th>
            </tr>
        </thead>
        <tbody>
            <% total_amt_received = 0 %>
            <% total_amt_returned = 0 %>
            <% total_paid = 0 %>
            <% total_debt = 0 %>
            <% payment_method = "" %>
            <% object.account_payable_payment_invoices.joins(account_payable: :vendor).select(:amount, "account_payables.number, account_payables.payment_method, account_payables.amount_returned, account_payables.giro_number, account_payables.giro_date, account_payables.payment_date, vendors.name, account_payables.total, account_payables.vendor_invoice_number, account_payables.vendor_invoice_date").each_with_index do |appi, index| %>
              <% payment_method = appi.payment_method %>
              <tr class="text-center">
                  <td><%= index + 1 %></td>
                  <td><%= appi.number %></td>
                  <td><%= appi.name %></td>
                  <td><%= appi.vendor_invoice_number %></td>
                  <td><%= appi.vendor_invoice_date.strftime("%d/%m/%Y") %></td>
                  <td><%= appi.giro_number %></td>
                  <td><%= appi.giro_date.strftime("%d/%m/%Y") if appi.giro_date.present? %></td>
                  <td><%= appi.payment_date.strftime("%d/%m/%Y") %></td>
                  <td class="text-right"><%= number_to_currency(appi.total, :separator => ",", :delimiter => ".", :unit => "Rp", :precision => 2) %></td>
                  <td class="text-right"><%= number_to_currency(appi.amount_returned, :separator => ",", :delimiter => ".", :unit => "Rp", :precision => 2) %></td>
                  <td class="text-right"><%= number_to_currency(appi.amount, :separator => ",", :delimiter => ".", :unit => "Rp", :precision => 2) %></td>
                  <% debt = appi.total - appi.amount_returned - appi.amount %>
                  <td class="text-right"><%= number_to_currency(debt, :separator => ",", :delimiter => ".", :unit => "Rp", :precision => 2) %></td>
              </tr>
              <% total_amt_received += appi.total %>
              <% total_amt_returned += appi.amount_returned %>
              <% total_paid += appi.amount %>
              <% total_debt += debt %>
            <% end %>
        </tbody>        
        <tfoot>
            <tr>
                <td colspan="8" style="text-align: right"><strong>Total</strong></td>
                <td style="text-align: right"><strong><%= number_to_currency(total_amt_received, :separator => ",", :delimiter => ".", :unit => "Rp", :precision => 2) %></strong></td>
                <td style="text-align: right"><strong><%= number_to_currency(total_amt_returned, :separator => ",", :delimiter => ".", :unit => "Rp", :precision => 2) %></strong></td>
                <td style="text-align: right"><strong><%= number_to_currency(total_paid, :separator => ",", :delimiter => ".", :unit => "Rp", :precision => 2) %></strong></td>
                <td style="text-align: right"><strong><%= number_to_currency(total_debt, :separator => ",", :delimiter => ".", :unit => "Rp", :precision => 2) %></strong></td>
            </tr>
        </tfoot>
    </table>
</td>

<script>
  $(function () {
      $("#show-app-payment-method-value-<%= object.id %>").html("<%= payment_method %>");
  });
</script>
