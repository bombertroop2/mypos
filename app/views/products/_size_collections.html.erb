<table border="1">
    <tr style="text-align: center">
        <th colspan="2" rowspan="2"></th>
        <th colspan="<%= @colors.size %>">Colors</th>
    </tr>
    <tr style="text-align: center">
        <% @colors.each do |color| %>
          <td><%= color.code %></td>
        <% end %>
    </tr>
    <% index = 0 %>
    <% @price_codes.each do |price_code| %>
      <% @sizes.each_with_index do |size, idx| %>
        <tr style="text-align: center">
            <% if idx.eql? 0 %>
              <th rowspan="<%= @sizes.size %>"><%= price_code.code %></th>
            <% end %>
            <td><%= size.size %></td>
            <% @colors.each do |color| %>
              <% product_detail = @product.product_details.select{|pd| pd.size_id.eql?(size.id) && pd.color_id.eql?(color.id) && pd.price_code_id.eql?(price_code.id)}.first %>
              <% unless product_detail %>
                <% product_detail = @product.product_details.build(size_id: size.id, color_id: color.id, price_code_id: price_code.id) %>
              <% end %>
              <td>
                  <% if product_detail.new_record? %>
                    <% product_detail_array_index = "product[product_details_attributes]["+Time.now.to_i.to_s+index.to_s+"]" %>
                  <% else %>
                    <% product_detail_array_index = "product[product_details_attributes][]" %>
                  <% end %>
                  <%= fields_for product_detail_array_index, product_detail do |product_detail_form| %>
                    <%= product_detail_form.hidden_field :id %>
                    <%= product_detail_form.hidden_field :size_id %>
                    <%= product_detail_form.hidden_field :color_id %>
                    <%= product_detail_form.hidden_field :price_code_id %>
                    <div class="field">
                        <%= product_detail_form.text_field :cost, placeholder: "cost" %>
                    </div>
                    <div class="field">
                        <%= product_detail_form.text_field :price, placeholder: "price" %>
                    </div>  
                  <% end %>
              </td>
              <% index += 1 %>
            <% end %>
        </tr>
      <% end %>
    <% end %>


</table>