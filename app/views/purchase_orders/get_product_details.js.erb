$("#product_ids").val("<%= params[:product_ids] %>");
if($("#products_detail").html().trim().length == 0)
$("#products_detail").html("<%= j(render(partial: "product_quantities")) %>");
else{
<% if @removed_ids.present? %>
  <% @removed_ids.each do |removed_id| %>
    // remove unuse product
    <% if @purchase_order.new_record? %>
      $("#product_table_<%= removed_id %>").remove();
    <% else %>
      // jika product sudah ada di database
      if($("#product_table_<%= removed_id %>").find("[type='checkbox']").length > 0){
      $("#product_table_<%= removed_id %>").hide();
      $("#product_table_<%= removed_id %>").find("[type='checkbox']").attr("checked", true);
      }
      else // jika produk belum ada di database
      $("#product_table_<%= removed_id %>").remove();
    <% end %>
  <% end %>
<% else %>
  <% if @replaced_ids.present? %>
    <% @replaced_ids.each do |replaced_id| %>
      // remove unuse product
      <% if @purchase_order.new_record? %>
        $("#product_table_<%= replaced_id %>").remove();
      <% else %>
        // jika product sudah ada di database
        if($("#product_table_<%= replaced_id %>").find("[type='checkbox']").length > 0){
        $("#product_table_<%= replaced_id %>").hide();
        $("#product_table_<%= replaced_id %>").find("[type='checkbox']").attr("checked", true);
        }
        else // jika produk belum ada di database
        $("#product_table_<%= replaced_id %>").remove();
      <% end %>
    <% end %>      
  <% end %>
  $("#products_detail").append("<%= j(render(partial: "product_quantities")) %>");
  showDeleteMarkedProduct();
<% end %>
}
