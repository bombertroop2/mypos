$("#product_ids").val("<%= params[:product_ids] %>");
if($("#products_detail").html().trim().length == 0)
$("#products_detail").html("<%= j(render(partial: "product_quantities")) %>");
else{
<% if @removed_ids.present? %>
  <% @removed_ids.each do |removed_id| %>
    // remove unuse product
    <% if @purchase_order.new_record? %>
      $("#product_table_<%= removed_id %>").remove();
    <% else %>
      $(".product-table").each(function(){
      var productId = $(this).attr("id").split("_")[2];
      if($(this).find("[type='checkbox']").length > 0 && $(this).attr("id").localeCompare("product_table_"+<%= removed_id %>) == 0) {
      $(this).hide();
      $(this).find("[type='checkbox']").attr("checked", true);
      $(this).find("input:text").remove();
      }
      else if($(this).find("[type='checkbox']").length == 0 && $(this).attr("id").localeCompare("product_table_"+<%= removed_id %>) == 0)
      $(this).remove();
      });      
    <% end %>
  <% end %>
<% else %>
  <% if @replaced_ids.present? %>
    <% @replaced_ids.each do |replaced_id| %>
      // remove unuse product
      <% if @purchase_order.new_record? %>
        $("#product_table_<%= replaced_id %>").remove();
      <% else %>
        $(".product-table").each(function(){
        var productId = $(this).attr("id").split("_")[2];
        if($(this).find("[type='checkbox']").length > 0 && $(this).attr("id").localeCompare("product_table_"+<%= replaced_id %>) == 0) {
        $(this).hide();
        $(this).find("[type='checkbox']").attr("checked", true);
        $(this).find("input:text").remove();
        }
        else if($(this).find("[type='checkbox']").length == 0 && $(this).attr("id").localeCompare("product_table_"+<%= replaced_id %>) == 0)
        $(this).remove();
        });
      <% end %>
    <% end %>      
  <% end %>
  $("#products_detail").append("<%= j(render(partial: "product_quantities")) %>");
  //showDeleteMarkedProduct();
<% end %>
}

<% @product_costs.each do |key, val| %>
  $("#product_table_cost_<%= key %>").html("<%= number_to_currency((val), :separator => ",", :delimiter => ".", :unit => "Rp", :precision => 2) %>");
<% end %>