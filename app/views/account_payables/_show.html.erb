<td colspan="4">
    <button type="button" class="close cancel" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <div style="padding-top: 20px"></div>
    <table class="table table-condensed table-responsive table-bordered">
        <tr>
            <td style="padding: 20px">
                <table width="100%">
                    <tr>
                        <td colspan="2"><strong><%= Company.name %></strong></td>
                    </tr>
                    <tr>
                        <td align="center" colspan="2"><strong>ACCOUNT PAYABLE</strong></td>
                    </tr>
                    <tr>
                        <td align="center" colspan="2"><%= @account_payable.number %></td>
                    </tr>
                    <tr>
                        <td>
                            <table class="table-condensed table-responsive">
                                <tr>
                                    <td>Vendor</td>
                                    <td>:</td>
                                    <td><%= @account_payable.vendor.name %></td>
                                </tr>
                                <tr>
                                    <td>Payment Date</td>
                                    <td>:</td>
                                    <td><%= @account_payable.payment_date.strftime("%d/%m/%Y") %></td>
                                </tr>
                                <tr>
                                    <td>Payment Method</td>
                                    <td>:</td>
                                    <td><%= @account_payable.payment_method %></td>
                                </tr>                                
                                <tr>
                                    <td>Giro Number</td>
                                    <td>:</td>
                                    <td><%= @account_payable.giro_number %></td>
                                </tr>                                
                                <tr>
                                    <td>Giro Date</td>
                                    <td>:</td>
                                    <td><%= @account_payable.giro_date.strftime("%d/%m/%Y") rescue "" %></td>
                                </tr>                                
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td align="center" colspan="2">
                            <table class="table table-condensed table-responsive table-bordered">
                                <tbody>
                                    <tr><th colspan="8" style="text-align: center">Items Received</th></tr>
                                    <tr style="text-align: center">
                                        <td><strong>No</strong></td>
                                        <td><strong>Doc. Number</strong></td>
                                        <td><strong>Qty</strong></td>
                                        <td><strong>Gross Amount</strong></td>
                                        <td><strong>1st Disc</strong></td>
                                        <td><strong>2nd Disc</strong></td>
                                        <td><strong>VAT (10%)</strong></td>
                                        <td><strong>Net Amount</strong></td>
                                    </tr>
                                    <% total_amount_received = 0 %>
                                    <% @account_payable.account_payable_purchases.select(:purchase_id, :purchase_type).each_with_index do |app, idx| %>
                                      <% purchase_order = app.purchase %>
                                      <tr align="center">
                                          <td style="vertical-align: middle"><%= idx.succ %></td>
                                          <td style="vertical-align: middle"><%= purchase_order.number %></td>
                                          <td align="right"><%= purchase_order.quantity_received %></td>
                                          <td align="right"><%= number_to_currency(purchase_order.receiving_value,
                                                :separator => ",",
                                                :delimiter => ".",
                                                :unit => "Rp",
                                                :precision => 2) %></td>
                                          <td>
                                              <% if purchase_order.first_discount.present? %>
                                                <%= number_to_currency((purchase_order.first_discount.to_f / 100) * purchase_order.receiving_value,
                                                  :separator => ",",
                                                  :delimiter => ".",
                                                  :unit => "Rp",
                                                  :precision => 2) %> (<%= "#{purchase_order.first_discount}%" %>)
                                              <% end %>
                                          </td>
                                          <td>
                                              <% if purchase_order.second_discount.present? %>
                                                <%= number_to_currency(get_second_discount_in_money_for_ap(purchase_order),
                                                  :separator => ",",
                                                  :delimiter => ".",
                                                  :unit => "Rp",
                                                  :precision => 2) %> (<%= "#{purchase_order.second_discount}%" %> from <%= purchase_order.is_additional_disc_from_net ? "net" : "gross" %>)
                                              <% end %>
                                          </td>
                                          <td>
                                              <% if purchase_order.is_taxable_entrepreneur %>
                                                <%= number_to_currency(get_vat_in_money_for_ap(purchase_order),
                                                  :separator => ",",
                                                  :delimiter => ".",
                                                  :unit => "Rp",
                                                  :precision => 2) %> (<%= purchase_order.value_added_tax %>)
                                              <% end %>
                                          </td>
                                          <td align="right"><%= number_to_currency(value_after_ppn_for_ap(purchase_order),
                                                :separator => ",",
                                                :delimiter => ".",
                                                :unit => "Rp",
                                                :precision => 2) %></td>
                                      </tr>
                                      <% total_amount_received += value_after_ppn_for_ap(purchase_order) %>
                                    <% end %>
                                    <tr>
                                        <td colspan="7" align="right"><strong>Total Amount Received</strong></td>
                                        <td align="right"><strong><%= number_to_currency(total_amount_received,
                                                  :separator => ",",
                                                  :delimiter => ".",
                                                  :unit => "Rp",
                                                  :precision => 2) %></strong></td>
                                    </tr>
                                    <% total_amount_returned = 0 %>
                                    <% allocated_return_items = @account_payable.allocated_return_items.select(:purchase_return_id) %>
                                    <% if allocated_return_items.size > 0 %>
                                      <tr><th colspan="8" style="text-align: center">Allocated Return Items</th></tr>
                                      <% @account_payable.allocated_return_items.select(:purchase_return_id).each_with_index do |ari, idx| %>
                                        <tr align="center">
                                            <td style="vertical-align: middle"><%= idx.succ %></td>
                                            <td style="vertical-align: middle"><%= ari.purchase_return.number %></td>
                                            <td align="right"><%= ari.purchase_return.quantity_returned %></td>
                                            <td align="right"><%= number_to_currency(total_return_value(ari.purchase_return),
                                                  :separator => ",",
                                                  :delimiter => ".",
                                                  :unit => "Rp",
                                                  :precision => 2) %></td>
                                            <td>
                                                <% if (ari.purchase_return.purchase_order && ari.purchase_return.purchase_order.first_discount.present?) || (ari.purchase_return.direct_purchase && ari.purchase_return.direct_purchase.first_discount.present?) %>
                                                  <%= number_to_currency(((ari.purchase_return.purchase_order.first_discount.to_f rescue ari.purchase_return.direct_purchase.first_discount.to_f) / 100) * total_return_value(ari.purchase_return),
                                                    :separator => ",",
                                                    :delimiter => ".",
                                                    :unit => "Rp",
                                                    :precision => 2) %> (<%= "#{(ari.purchase_return.purchase_order.first_discount rescue ari.purchase_return.direct_purchase.first_discount)}%" %>)
                                                <% end %>
                                            </td>
                                            <td>
                                                <% if (ari.purchase_return.purchase_order && ari.purchase_return.purchase_order.second_discount.present?) || (ari.purchase_return.direct_purchase && ari.purchase_return.direct_purchase.second_discount) %>
                                                  <%= number_to_currency(get_second_discount_in_money_pr(ari.purchase_return),
                                                    :separator => ",",
                                                    :delimiter => ".",
                                                    :unit => "Rp",
                                                    :precision => 2) %> (<%= "#{(ari.purchase_return.purchase_order.second_discount rescue ari.purchase_return.direct_purchase.second_discount)}%" %> from <%= (ari.purchase_return.purchase_order && ari.purchase_return.purchase_order.is_additional_disc_from_net) || (ari.purchase_return.direct_purchase && ari.purchase_return.direct_purchase.is_additional_disc_from_net) ? "net" : "gross" %>)
                                                <% end %>
                                            </td>
                                            <td>
                                                <% if ari.purchase_return.purchase_order && ari.purchase_return.purchase_order.is_taxable_entrepreneur %>
                                                  <%= number_to_currency(get_vat_in_money_pr(ari.purchase_return),
                                                    :separator => ",",
                                                    :delimiter => ".",
                                                    :unit => "Rp",
                                                    :precision => 2) %> (<%= ari.purchase_return.purchase_order.value_added_tax %>)
                                                <% elsif ari.purchase_return.direct_purchase && ari.purchase_return.direct_purchase.is_taxable_entrepreneur %>
                                                  <%= number_to_currency(get_vat_in_money_pr(ari.purchase_return),
                                                    :separator => ",",
                                                    :delimiter => ".",
                                                    :unit => "Rp",
                                                    :precision => 2) %> (<%= ari.purchase_return.direct_purchase.vat_type %>)
                                                <% end %>
                                            </td>
                                            <td align="right">
                                                <%= number_to_currency(value_after_ppn_pr(ari.purchase_return),
                                                  :separator => ",",
                                                  :delimiter => ".",
                                                  :unit => "Rp",
                                                  :precision => 2) %>
                                            </td>
                                        </tr>
                                        <% total_amount_returned += value_after_ppn_pr(ari.purchase_return) %>
                                      <% end %>
                                      <tr>
                                          <td colspan="7" align="right"><strong>Total Amount Returned</strong></td>
                                          <td align="right"><strong><%= number_to_currency(total_amount_returned,
                                                    :separator => ",",
                                                    :delimiter => ".",
                                                    :unit => "Rp",
                                                    :precision => 2) %></strong></td>
                                      </tr>                                    
                                    <% end %>
                                </tbody>
                                <% previous_paid = total_amount_received - total_amount_returned - @account_payable.debt %>                                
                                <tfoot>
                                    <tr>
                                        <td colspan="7" align="right"><strong>Previous Paid</strong></td>
                                        <td align="right"><strong><%= number_to_currency(previous_paid,
                                                  :separator => ",",
                                                  :delimiter => ".",
                                                  :unit => "Rp",
                                                  :precision => 2) %></strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </td>
                    </tr>
                    <!--
                    <tr>
                        <td>Created by</td>
                        <td style="text-align: right">Approved by</td>
                    </tr>
                    <tr>
                        <td style="padding-top: 50px"><%#= @purchase_order.creator.name rescue "Admin" %></td>
                        <td style="text-align: right"></td>
                    </tr>-->
                </table>
            </td>
        </tr>
    </table>



</td>
